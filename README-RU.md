# ChaCha-VR
ChaCha-Variable, Proof of concept. Почему? Потому что скучно было.

# ChaCha-VR (Variable Rounds) — PoC

**ChaCha-VR (Variable Rounds)** — это исследовательская реализация поточного шифра на базе **ChaCha**, поддерживающая переменное число раундов (от 2 до 1000 и выше), с дополнительным перемешиванием начального состояния (**pre_mix_state**) для усиления лавинного эффекта.  
Данный проект разработан как **Proof of Concept (PoC)** для изучения влияния нестандартного количества раундов, модификации внутреннего состояния, и безопасности на основе лавинных и производительных свойств алгоритма.

---

##  Основные возможности

-  **Переменное число раундов** (от 2 до 1000+).
-  Поддержка **128-битного и 256-битного ключа**.
-  Поддержка **64-битного и 96-битного nonce**.
-  Встроенное **предварительное перемешивание состояния** (аналог pre-mixing в hash-конструкциях).
-  **Обфускация keystream** (простое маскирование).
-  **Автоматические тесты** на реальных данных:
  - **KAT (Known Answer Test)** — проверка детерминированности результата шифрования.
  - **Avalanche тест** — оценка лавинного эффекта (сколько бит изменяются при флипе одного бита ключа).
  - **Скоростной тест (MB/s)** — измерение пропускной способности алгоритма.
-  **Многопоточность через Rayon** — автоматическая параллельная обработка множества файлов.
-  Гарантированное уничтожение секретных данных (через `zeroize` и `SecretBox`).

---

##  Цели проекта

1. **Проверка влияния числа раундов** на производительность и безопасность.
2. **Оценка лавинного эффекта** при варьировании параметров.
3. **Тестирование алгоритма на реальных данных** (файлы произвольного размера).

---

##  Структура проекта

- **ChaChaVR** — основная структура шифра с:
  - `process()` — шифрование и дешифрование.
  - `obfuscate_keystream()` — обфускация внутреннего потока.
- **pre_mix_state()** — перемешивание начального состояния для усиления диффузии.
- **Тестовый модуль**:
  - `test_file()` — полный тест для одного файла (KAT, Avalanche, Speed).
  - `real_world_tests()` — обработка всех файлов в папке параллельно.

---

##  Как использовать

1. **Установить зависимости:**
```bash
cargo add zeroize secrecy rand rayon
```

2. **Запустить тесты на своей директории:**
```rust
fn main() {
    let rounds = 42; // любое чётное число >= 2
    let dir_path = "test_data"; // путь к вашей папке с файлами
    real_world_tests(dir_path, rounds);
}
```

3. **Результат включает:**
- Проверку детерминированности (KAT).
- Проверку корректной расшифровки.
- Оценку лавинного эффекта (в среднем бит на бит ключа).
- Измерение скорости шифрования (MB/s).

---

##  Пример вывода

```text
=== Реальные тесты ===
Найдено 5 файлов в test_data
Файл: "video.mp4" (4500000 байт)
  KAT PASS
  Расшифровка PASS
  Avalanche: 256.12 бит на флип бита ключа
  Скорость: 325.43 MB/s (время: 0.013 с)
```

---

##  Предупреждение

> **ChaCha-VR — это не стандартный алгоритм и не предназначен для использования в продакшене.**  
> Это мини исследовательская работа для анализа влияния раундов и модификаций на безопасность и производительность.  
> Не рекомендуется для использования в системах с высокими требованиями к безопасности без независимого, полного аудита.

### Помощь ИИ

Некоторые части этого проекта (например, первоначальные черновики, форматирование и тестирование идей) были созданы с помощью инструментов ИИ (например, ChatGPT). Однако вся криптологическая логика, алгоритмическое проектирование и методологии тестирования были разработаны(хотя скорее написаны), проверены и завершены автором в рамках независимых исследований.
---

##  TODO (Идеи для будущего)

- [ ] Поддержка потокового шифрования для больших файлов.
- [ ] Реализация официальных тестов (NIST, Wycheproof).
- [ ] Интеграция с Crypto API.
- [ ] Более сложная обфускация keystream (динамические маски).
- [ ] Реализация многопоточного режима "данные делятся между потоками" (вместо "файл на поток").

---

## Контакты

Если у тебя есть вопросы или предложения — **создавай issue** или **форкай проект**.

---

## Лицензия

MIT License. Открыто для некоммерческого и исследовательского использования. Использование на свой страх и риск.

---

## Почему это важно?

Этот проект помогает ответить на вопросы:
- **Как меняется лавинный эффект при малом и большом числе раундов?**
- **Как сильно влияет pre-mix на безопасность?**
- **Какая реальная скорость может быть достигнута при шифровании гигабайтных файлов?**
- **Можно ли эффективно кастомизировать ChaCha для нестандартных задач?**

---